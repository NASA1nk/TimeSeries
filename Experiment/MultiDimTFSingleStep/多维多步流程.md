# 数据

## 读取csv

读入多列的csv文件，选择时间和特定列数

- data：**(3936, 10)**

```bash
# data.head()
135	319.383260	151.610865	200.000000	261.290323	447.761194	336.864407	72.737686	327.891156	3252.100840	265.6250
136	362.334802	138.976627	170.140845	268.817204	389.552239	349.576271	81.328751	334.693878	3210.084034	250.0000
137	342.511013	145.293746	158.873239	249.462366	362.686567	302.966102	73.310424	337.414966	3411.764706	265.6250
138	343.612335	145.293746	145.352113	240.860215	392.537313	362.288136	72.737686	355.102041	3453.781513	273.4375
139	339.207048	151.610865	149.859155	219.354839	382.089552	298.728814	69.873998	344.217687	3336.134454	257.8125
```

`series = data.to_numpy()`：**(3936, 10)**

- 其中每个数据即一行的10列数据，一共3936行

```json
// series
array([[ 319.38325991,  151.61086545,  200.        , ...,  327.89115646,
        3252.10084034,  265.625     ],
       [ 362.33480176,  138.97662666,  170.14084507, ...,  334.69387755,
        3210.08403361,  250.        ],
       [ 342.51101322,  145.29374605,  158.87323944, ...,  337.41496599,
        3411.76470588,  265.625     ],
       ...,
       [ 748.89867841,  233.73341756,  187.04225352, ...,  771.42857143,
        5260.50420168,  570.3125    ],
       [ 686.12334802,  176.87934302,  181.97183099, ...,  663.94557823,
        4831.93277311,  585.9375    ],
       [ 525.33039648,  170.56222363,  185.91549296, ...,  606.80272109,
        4630.25210084,  570.3125    ]])
```

## 划分数据

选取2800长度的数据，即2800行

- data：**(2800,10)**

划分数据的目的是在这个2800*10的矩阵中对每10列同时维护一个input_window = 100的滑动窗口

- 所以一共有**len(data) - input_window = 2800 - 100 = 2700**个窗口
- 每个窗口data：**(100,10)**

> 行数（纵向长度）为100

### 输入

train_seq：**(100,10)**

```json
// 由95个真实值和5个0拼接而成100
array([
   	   [-0.90168539, -0.54098361, -0.07988981, -0.51408451, -0.04545455,
        -0.25280899, -0.9       , -0.48230088, -0.83835182, -0.84210526],
      
     ...
       [-0.80898876, -0.54098361, -0.79614325, -0.59859155, -0.06168831,
        -0.13483146, -0.90555556, -0.42920354, -0.76228209, -0.73684211]
])

// output_window = 5
array([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]])
```

相当于在每一列后面补上了**output_window = 5**个0，即在整个数据加上了output_window = 5行的10个0

`np.append(arr, values, axis=None)`

- axis：可选参数，如果axis没有给出，那么arr，values都将先展平成一维数组
  - 如果axis被指定，那么arr和values需要同为一维数组或者**有相同的shape**
  - axis的最大值为数组**arr的维数-1**，当arr的维数为2，**axis=0表示沿着行增长方向添加values**，axis=1表示沿着列增长方向添加values

```python
train_seq = np.append(input_data[i:i+tw-output_window,:], np.zeros((output_window,10)),axis=0)
```

```json
array([
    [-0.90168539, -0.54098361, -0.07988981, -0.51408451, -0.04545455,
        -0.25280899, -0.9       , -0.48230088, -0.83835182, -0.84210526],
      
		...
       [-0.80898876, -0.54098361, -0.79614325, -0.59859155, -0.06168831,
        -0.13483146, -0.90555556, -0.42920354, -0.76228209, -0.73684211],
       [ 0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ],
      ...
       [ 0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ]
])
```

### inout

**一个train_seq和一个train_label组成一个输入输入(inout)**，即**(2,100,10)**

一共2700个数据，所以最后的train_data为**(2700,2,100,10)**

- **2700个窗口，每个数据由2个list组成，一个src，一个targets**，**每个list都是100*10，有100个数组组成，每个数组10个值**

train_data

```json
// 2700个窗口
tensor
([
// [0]
[
	// list[0]
    [
        // 100*10
        [-0.9017, -0.5410, -0.0799,  ..., -0.4823, -0.8384, -0.8421],
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
                  ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
    ],
	// list[1]
    [
        // 100*10
        [-0.9017, -0.5410, -0.0799,  ..., -0.4823, -0.8384, -0.8421],
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
                  ...,
        [-0.7275, -0.6066, -0.8237,  ..., -0.2367, -0.6070, -0.7368],
        [-0.6517, -0.5410, -0.8733,  ..., -0.1748, -0.5658, -0.6842],
        [-0.6798, -0.5738, -0.8237,  ..., -0.3274, -0.6609, -0.6316]
    ]
],

// [1]
[
    // list[0]
    [
    	// 100*10
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
        [-0.8399, -0.5738, -0.6143,  ..., -0.4381, -0.7623, -0.8158],
        ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
	],
	// list[1]
    [
        // 100*10
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
     	[-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
    	[-0.8399, -0.5738, -0.6143,  ..., -0.4381, -0.7623, -0.8158],
         ...,
        [-0.6517, -0.5410, -0.8733,  ..., -0.1748, -0.5658, -0.6842],
        [-0.6798, -0.5738, -0.8237,  ..., -0.3274, -0.6609, -0.6316],
        [-0.7360, -0.4754, -0.7686,  ..., -0.3429, -0.7021, -0.7368]
	]
],	
		...

// [2699]
[
    // list[0]
    [
        [-0.6517, -0.5410, -0.7410,  ..., -0.3827, -0.9620, -0.7368],
        [-0.6601, -0.6393, -0.7631,  ..., -0.3872, -0.8637, -0.7895],
        [-0.7219, -0.6393, -0.7576,  ..., -0.4159, -0.9366, -0.7895],
        ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
    ],
    // list[1]
    [
        [-0.6517, -0.5410, -0.7410,  ..., -0.3827, -0.9620, -0.7368],
        [-0.6601, -0.6393, -0.7631,  ..., -0.3872, -0.8637, -0.7895],
        [-0.7219, -0.6393, -0.7576,  ..., -0.4159, -0.9366, -0.7895],
        ...,
        [-0.6489, -0.5738, -0.7961,  ..., -0.3363, -0.9398, -0.8684],
        [-0.8399, -0.7049, -0.8017,  ..., -0.4049, -0.9271, -0.8684],
        [-0.8792, -0.6721, -0.7961,  ..., -0.3805, -0.9525, -0.8421]
    ]
]
])
```

# 训练

## batch

将train_data即**(2700,2,100,10)**划分为一个batch，得到(32,2,100,10)

```python
input = torch.stack(torch.stack([item[0] for item in data]).chunk(input_window,1)).squeeze()
target = torch.stack(torch.stack([item[1] for item in data]).chunk(input_window,1)).squeeze()


a = [item[0] for item in data]
b = torch.stack(a)
c = b.chunk(input_window,1)
d = torch.stack(c)
e = d.squeeze()
```

1. 先拿到(32,2,100,10)的每个数据的第一个list，即输入100*10，得到a：32个(100,10)


```json
// a
[
tensor(
// [0]
[
        // 100*10
        [-0.9017, -0.5410, -0.0799, -0.5141, -0.0455, -0.2528, -0.9000, -0.4823,
         -0.8384, -0.8421],

        ...

        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
          0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
          0.0000,  0.0000]
], device='cuda:0'), 
// [1]
tensor(
[
        // 100*10
        [-0.7921, -0.6066, -0.3719, -0.4894, -0.1721, -0.2191, -0.8167, -0.4712,
         -0.8542, -0.8947],

        ...
        
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
          0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
          0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
          0.0000,  0.0000]
], device='cuda:0'), 
...

]
```

2. 然后对这些数据进行stack拼接
   1. torch.stack(inputs, dim=?)，对inputs（多个tensor）沿指定维度dim拼接，返回一维的tensor
   2. 即这32个(100,10)的tensor拼在一起，返回一个(32,100,10)的一个大的tensor

```json
// b
tensor(
[
    // [0]
    [
        // 100 * 10
        // 100个数组，每个数组有10个值（100行，每行10个数）
        [-0.9017, -0.5410, -0.0799,  ..., -0.4823, -0.8384, -0.8421],
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
        ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
    ],

        ...,
    // [31]
    [
        // 100 * 10
        [-0.7865, -0.4426, -0.6474,  ..., -0.4137, -0.8479, -0.8421],
        [-0.8399, -0.4426, -0.7355,  ..., -0.5000, -0.9144, -0.9211],
        [-0.7753, -0.5082, -0.7245,  ..., -0.4226, -0.9113, -0.8421],
        ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
    ]
],
device='cuda:0')
```

3. 然后对这些数据进行chunk切分
   1. torch.chunk(tensor, chunk_num, dim)，将tensor在指定维度上（0行，1列）分为chunk_num块，返回一个tensor tuple
   2. torch.chunk(x,output_window,1)

```json
(
tensor(
    // (32,1,10)
    [   
        // 0
        [[-0.9017, -0.5410, -0.0799, -0.5141, -0.0455, -0.2528, -0.9000,
          -0.4823, -0.8384, -0.8421]],

        [[-0.7921, -0.6066, -0.3719, -0.4894, -0.1721, -0.2191, -0.8167,
          -0.4712, -0.8542, -0.8947]],

        [[-0.8427, -0.5738, -0.4821, -0.5528, -0.2305, -0.3427, -0.8944,
          -0.4668, -0.7781, -0.8421]],

        [[-0.8399, -0.5738, -0.6143, -0.5810, -0.1656, -0.1854, -0.9000,
          -0.4381, -0.7623, -0.8158]],

        [[-0.8511, -0.5410, -0.5702, -0.6514, -0.1883, -0.3539, -0.9278,
          -0.4558, -0.8067, -0.8684]],

        [[-0.8174, -0.5410, -0.6804, -0.6021, -0.1364, -0.1517, -0.8500,
          -0.4226, -0.8384, -0.8684]],

        [[-0.8989, -0.5738, -0.5978, -0.6056, -0.1169, -0.3539, -0.6667,
          -0.4027, -0.8479, -0.9211]],

        [[-0.8146, -0.5082, -0.6694, -0.6021, -0.1169, -0.2640, -0.8389,
          -0.4027, -0.8320, -0.9211]],

        [[-0.9073, -0.5738, -0.6529, -0.6092, -0.1006, -0.2697, -0.9556,
          -0.4447, -0.8764, -0.8947]],

        [[-0.8511, -0.6066, -0.7190, -0.5352, -0.2922, -0.3483, -0.8778,
          -0.4668, -0.9017, -0.8947]],

        [[-0.8596, -0.5410, -0.8182, -0.5880, -0.3052, -0.4157, -0.8500,
          -0.4712, -0.8193, -0.8684]],

        [[-0.8680, -0.5082, -0.7521, -0.6408, -0.1136, -0.4719, -0.9111,
          -0.4336, -0.8510, -0.9211]],

        [[-0.9045, -0.5410, -0.7576, -0.6725, -0.2013, -0.3202, -0.9389,
          -0.4712, -0.8637, -0.9474]],

        [[-0.9326, -0.6721, -0.8347, -0.4472, -0.2727, -0.5449, -0.9056,
          -0.4801, -0.8796, -0.9211]],

        [[-0.8680, -0.5738, -0.8512, -0.6127, -0.1981, -0.3820, -0.8833,
          -0.4491, -0.8700, -0.9211]],

        [[-0.9438, -0.6066, -0.8347, -0.6338, -0.2987, -0.5899, -0.9111,
          -0.4801, -0.8479, -0.9211]],

        [[-0.9382, -0.5738, -0.7796, -0.6197, -0.1591, -0.3764, -0.9222,
          -0.5177, -0.8732, -0.9474]],

        [[-0.9185, -0.6393, -0.7906, -0.5211, -0.2727, -0.3202, -0.8889,
          -0.4646, -0.8447, -0.9474]],

        [[-0.9129, -0.6066, -0.7631, -0.4542, -0.1721, -0.5169, -0.9222,
          -0.4403, -0.8130, -0.9474]],

        [[-0.9242, -0.5738, -0.7466, -0.6092, -0.2792, -0.4719, -0.9056,
          -0.4513, -0.8700, -0.9474]],

        [[-0.9438, -0.5738, -0.7245, -0.6056, -0.2890, -0.3820, -0.9444,
          -0.4779, -0.8384, -0.9474]],

        [[-0.9494, -0.5738, -0.6694, -0.4472, -0.1721, -0.5169, -0.9111,
          -0.5088, -0.8796, -1.0000]],

        [[-0.9522, -0.6066, -0.6143, -0.5458, -0.2305, -0.3090, -0.9278,
          -0.4735, -0.8384, -0.9737]],

        [[-0.9466, -0.5082, -0.7466, -0.5845, -0.2890, -0.3596, -0.9278,
          -0.4690, -0.8827, -0.9474]],

        [[-0.9466, -0.5410, -0.6860, -0.6056, -0.2338, -0.4888, -0.9278,
          -0.4403, -0.8732, -0.8684]],

        [[-0.8820, -0.5082, -0.6309, -0.5599, -0.0617, -0.3652, -0.9889,
          -0.5022, -0.8384, -0.9211]],

        [[-0.8511, -0.5410, -0.6915, -0.5352, -0.2110, -0.4270, -0.9556,
          -0.4978, -0.8162, -0.9474]],

        [[-0.8062, -0.4754, -0.6860, -0.7077, -0.1818, -0.3371, -0.9444,
          -0.4469, -0.8162, -0.9737]],

        [[-0.8680, -0.4754, -0.7080, -0.5493, -0.1818, -0.5562, -0.7722,
          -0.4535, -0.8320, -0.8684]],

        [[-0.8230, -0.5082, -0.6474, -0.6408, -0.1331, -0.2528, -0.7944,
          -0.4425, -0.7781, -0.8158]],

        [[-0.8455, -0.4754, -0.7135, -0.6866, -0.1558, -0.4101, -0.9000,
          -0.4027, -0.7433, -0.8421]],

        [[-0.7865, -0.4426, -0.6474, -0.6761, -0.1981, -0.4382, -0.9222,
          -0.4137, -0.8479, -0.8421]]
    ], 
device='cuda:0'), 

tensor([[[-0.9326, -0.6721, -0.8347, -0.4472, -0.2727, -0.5449, -0.9056,
          -0.4801, -0.8796, -0.9211]],

        [[-0.8680, -0.5738, -0.8512, -0.6127, -0.1981, -0.3820, -0.8833,
          -0.4491, -0.8700, -0.9211]],

        [[-0.9438, -0.6066, -0.8347, -0.6338, -0.2987, -0.5899, -0.9111,
          -0.4801, -0.8479, -0.9211]],

        [[-0.9382, -0.5738, -0.7796, -0.6197, -0.1591, -0.3764, -0.9222,
          -0.5177, -0.8732, -0.9474]],

        [[-0.9185, -0.6393, -0.7906, -0.5211, -0.2727, -0.3202, -0.8889,
          -0.4646, -0.8447, -0.9474]],

        [[-0.9129, -0.6066, -0.7631, -0.4542, -0.1721, -0.5169, -0.9222,
          -0.4403, -0.8130, -0.9474]],

        [[-0.9242, -0.5738, -0.7466, -0.6092, -0.2792, -0.4719, -0.9056,
          -0.4513, -0.8700, -0.9474]],

        [[-0.9438, -0.5738, -0.7245, -0.6056, -0.2890, -0.3820, -0.9444,
          -0.4779, -0.8384, -0.9474]],

        [[-0.9494, -0.5738, -0.6694, -0.4472, -0.1721, -0.5169, -0.9111,
          -0.5088, -0.8796, -1.0000]],

        [[-0.9522, -0.6066, -0.6143, -0.5458, -0.2305, -0.3090, -0.9278,
          -0.4735, -0.8384, -0.9737]],

        [[-0.9466, -0.5082, -0.7466, -0.5845, -0.2890, -0.3596, -0.9278,
          -0.4690, -0.8827, -0.9474]],

        [[-0.9466, -0.5410, -0.6860, -0.6056, -0.2338, -0.4888, -0.9278,
          -0.4403, -0.8732, -0.8684]],

        [[-0.8820, -0.5082, -0.6309, -0.5599, -0.0617, -0.3652, -0.9889,
          -0.5022, -0.8384, -0.9211]],

        [[-0.8511, -0.5410, -0.6915, -0.5352, -0.2110, -0.4270, -0.9556,
          -0.4978, -0.8162, -0.9474]],

        [[-0.8062, -0.4754, -0.6860, -0.7077, -0.1818, -0.3371, -0.9444,
          -0.4469, -0.8162, -0.9737]],

        [[-0.8680, -0.4754, -0.7080, -0.5493, -0.1818, -0.5562, -0.7722,
          -0.4535, -0.8320, -0.8684]],

        [[-0.8230, -0.5082, -0.6474, -0.6408, -0.1331, -0.2528, -0.7944,
          -0.4425, -0.7781, -0.8158]],

        [[-0.8455, -0.4754, -0.7135, -0.6866, -0.1558, -0.4101, -0.9000,
          -0.4027, -0.7433, -0.8421]],

        [[-0.7865, -0.4426, -0.6474, -0.6761, -0.1981, -0.4382, -0.9222,
          -0.4137, -0.8479, -0.8421]],

        [[-0.8399, -0.4426, -0.7355, -0.7113, -0.1623, -0.3427, -0.9389,
          -0.5000, -0.9144, -0.9211]],

        [[-0.7753, -0.5082, -0.7245, -0.6655, -0.1656, -0.4944, -0.9167,
          -0.4226, -0.9113, -0.8421]],

        [[-0.8399, -0.5410, -0.6639, -0.6338, -0.2435, -0.4551, -0.8889,
          -0.4358, -0.8384, -0.8684]],

        [[-0.7893, -0.4754, -0.3113, -0.6901, -0.0714, -0.3202, -0.8056,
          -0.4292, -0.8447, -0.8421]],

        [[-0.7303, -0.4426, -0.3388, -0.7394, -0.0974, -0.3146, -0.9000,
          -0.4735, -0.8954, -0.8421]],

        [[-0.7388, -0.5738, -0.2948, -0.6831, -0.1818, -0.3483, -0.9167,
          -0.5420, -0.8003, -0.7632]],

        [[-0.7135, -0.5410, -0.3168, -0.6831, -0.0942, -0.3708, -0.9000,
          -0.5155, -0.8193, -0.8421]],

        [[-0.7444, -0.5410, -0.3554, -0.7148, -0.0909, -0.5000, -0.8889,
          -0.5310, -0.8447, -0.8421]],

        [[-0.7303, -0.4754, -0.2893, -0.7394, -0.1948, -0.4270, -0.8500,
          -0.5509, -0.8447, -0.9211]],

        [[-0.7360, -0.6066, -0.3609, -0.7007, -0.2110, -0.2135, -0.8556,
          -0.5199, -0.8067, -0.8947]],

        [[-0.7556, -0.6066, -0.2672, -0.6585, -0.0974, -0.4831, -0.8889,
          -0.4845, -0.8574, -0.8947]],

        [[-0.7697, -0.5410, -0.6419, -0.6303, -0.1494, -0.3258, -0.9056,
          -0.5044, -0.8415, -0.8421]],

        [[-0.7893, -0.4754, -0.9284, -0.7430, -0.0974, -0.3652, -0.9000,
          -0.5376, -0.8669, -0.8684]]], device='cuda:0'), ...)
```