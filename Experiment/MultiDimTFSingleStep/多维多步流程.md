# 数据

## 读取csv

读入多列的csv文件，选择时间和特定列数

- data：**(3936, 10)**

```bash
# data.head()
135	319.383260	151.610865	200.000000	261.290323	447.761194	336.864407	72.737686	327.891156	3252.100840	265.6250
136	362.334802	138.976627	170.140845	268.817204	389.552239	349.576271	81.328751	334.693878	3210.084034	250.0000
137	342.511013	145.293746	158.873239	249.462366	362.686567	302.966102	73.310424	337.414966	3411.764706	265.6250
138	343.612335	145.293746	145.352113	240.860215	392.537313	362.288136	72.737686	355.102041	3453.781513	273.4375
139	339.207048	151.610865	149.859155	219.354839	382.089552	298.728814	69.873998	344.217687	3336.134454	257.8125
```

`series = data.to_numpy()`：**(3936, 10)**

- 其中每个数据即一行的10列数据，一共3936行

```json
// series
array([[ 319.38325991,  151.61086545,  200.        , ...,  327.89115646,
        3252.10084034,  265.625     ],
       [ 362.33480176,  138.97662666,  170.14084507, ...,  334.69387755,
        3210.08403361,  250.        ],
       [ 342.51101322,  145.29374605,  158.87323944, ...,  337.41496599,
        3411.76470588,  265.625     ],
       ...,
       [ 748.89867841,  233.73341756,  187.04225352, ...,  771.42857143,
        5260.50420168,  570.3125    ],
       [ 686.12334802,  176.87934302,  181.97183099, ...,  663.94557823,
        4831.93277311,  585.9375    ],
       [ 525.33039648,  170.56222363,  185.91549296, ...,  606.80272109,
        4630.25210084,  570.3125    ]])
```

## 划分数据

选取2800长度的数据，即2800行

- data：**(2800,10)**

划分数据的目的是在这个2800*10的矩阵中对每10列同时维护一个input_window = 100的滑动窗口

- 所以一共有**len(data) - input_window = 2800 - 100 = 2700**个窗口
- 每个窗口data：**(100,10)**

> 行数（纵向长度）为100

### 输入

train_seq：**(100,10)**

```json
// 由95个真实值和5个0拼接而成100
array([
   	   [-0.90168539, -0.54098361, -0.07988981, -0.51408451, -0.04545455,
        -0.25280899, -0.9       , -0.48230088, -0.83835182, -0.84210526],
      
     ...
       [-0.80898876, -0.54098361, -0.79614325, -0.59859155, -0.06168831,
        -0.13483146, -0.90555556, -0.42920354, -0.76228209, -0.73684211]
])

// output_window = 5
array([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]])
```

相当于在每一列后面补上了**output_window = 5**个0，即在整个数据加上了output_window = 5行的10个0

`np.append(arr, values, axis=None)`

- axis：可选参数，如果axis没有给出，那么arr，values都将先展平成一维数组
  - 如果axis被指定，那么arr和values需要同为一维数组或者**有相同的shape**
  - axis的最大值为数组**arr的维数-1**，当arr的维数为2，**axis=0表示沿着行增长方向添加values**，axis=1表示沿着列增长方向添加values

```python
train_seq = np.append(input_data[i:i+tw-output_window,:], np.zeros((output_window,10)),axis=0)
```

```json
array([
    [-0.90168539, -0.54098361, -0.07988981, -0.51408451, -0.04545455,
        -0.25280899, -0.9       , -0.48230088, -0.83835182, -0.84210526],
      
		...
       [-0.80898876, -0.54098361, -0.79614325, -0.59859155, -0.06168831,
        -0.13483146, -0.90555556, -0.42920354, -0.76228209, -0.73684211],
       [ 0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ],
      ...
       [ 0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ]
])
```

### inout

**一个train_seq和一个train_label组成一个输入输入(inout)**，即**(2,100,10)**

一共2700个数据，所以最后的train_data为**(2700,2,100,10)**

- **2700个窗口，每个数据由2个list组成，一个src，一个targets**，**每个list都是100*10，有100个数组组成，每个数组10个值**

train_data

```json
tensor(
[
// 2700个窗口
// [0]
[
	// list[0]
    [
        // 100*10
        [-0.9017, -0.5410, -0.0799,  ..., -0.4823, -0.8384, -0.8421],
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
                  ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
    ],
	// list[1]
    [
        // 100*10
        [-0.9017, -0.5410, -0.0799,  ..., -0.4823, -0.8384, -0.8421],
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
                  ...,
        [-0.7275, -0.6066, -0.8237,  ..., -0.2367, -0.6070, -0.7368],
        [-0.6517, -0.5410, -0.8733,  ..., -0.1748, -0.5658, -0.6842],
        [-0.6798, -0.5738, -0.8237,  ..., -0.3274, -0.6609, -0.6316]
    ]
],

// [1]
[
    // list[0]
    [
    	// 100*10
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
        [-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
        [-0.8399, -0.5738, -0.6143,  ..., -0.4381, -0.7623, -0.8158],
        ...,
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]
	],
	// list[1]
    [
        // 100*10
        [-0.7921, -0.6066, -0.3719,  ..., -0.4712, -0.8542, -0.8947],
     	[-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
    	[-0.8399, -0.5738, -0.6143,  ..., -0.4381, -0.7623, -0.8158],
         ...,
        [-0.6517, -0.5410, -0.8733,  ..., -0.1748, -0.5658, -0.6842],
        [-0.6798, -0.5738, -0.8237,  ..., -0.3274, -0.6609, -0.6316],
        [-0.7360, -0.4754, -0.7686,  ..., -0.3429, -0.7021, -0.7368]
	]
],


        [[[-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
          [-0.8399, -0.5738, -0.6143,  ..., -0.4381, -0.7623, -0.8158],
          [-0.8511, -0.5410, -0.5702,  ..., -0.4558, -0.8067, -0.8684],
          ...,
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]],

         [[-0.8427, -0.5738, -0.4821,  ..., -0.4668, -0.7781, -0.8421],
          [-0.8399, -0.5738, -0.6143,  ..., -0.4381, -0.7623, -0.8158],
          [-0.8511, -0.5410, -0.5702,  ..., -0.4558, -0.8067, -0.8684],
          ...,
          [-0.6798, -0.5738, -0.8237,  ..., -0.3274, -0.6609, -0.6316],
          [-0.7360, -0.4754, -0.7686,  ..., -0.3429, -0.7021, -0.7368],
          [-0.7275, -0.5082, -0.7466,  ..., -0.3717, -0.7528, -0.7105]]],

        ...,

        [[[-0.5955, -0.5738, -0.7686,  ..., -0.3385, -0.8859, -0.6842],
          [-0.6180, -0.6066, -0.8567,  ..., -0.3739, -0.8415, -0.7105],
          [-0.6517, -0.5410, -0.7410,  ..., -0.3827, -0.9620, -0.7368],
          ...,
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]],

         [[-0.5955, -0.5738, -0.7686,  ..., -0.3385, -0.8859, -0.6842],
          [-0.6180, -0.6066, -0.8567,  ..., -0.3739, -0.8415, -0.7105],
          [-0.6517, -0.5410, -0.7410,  ..., -0.3827, -0.9620, -0.7368],
          ...,
          [-0.6376, -0.6721, -0.8072,  ..., -0.3208, -0.9398, -0.8421],
          [-0.6348, -0.6066, -0.8237,  ..., -0.3296, -0.9334, -0.8158],
          [-0.6489, -0.5738, -0.7961,  ..., -0.3363, -0.9398, -0.8684]]],
		
		...
		// 2699
        [[[-0.6517, -0.5410, -0.7410,  ..., -0.3827, -0.9620, -0.7368],
          [-0.6601, -0.6393, -0.7631,  ..., -0.3872, -0.8637, -0.7895],
          [-0.7219, -0.6393, -0.7576,  ..., -0.4159, -0.9366, -0.7895],
          ...,
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000]],

         [[-0.6517, -0.5410, -0.7410,  ..., -0.3827, -0.9620, -0.7368],
          [-0.6601, -0.6393, -0.7631,  ..., -0.3872, -0.8637, -0.7895],
          [-0.7219, -0.6393, -0.7576,  ..., -0.4159, -0.9366, -0.7895],
          ...,
          [-0.6489, -0.5738, -0.7961,  ..., -0.3363, -0.9398, -0.8684],
          [-0.8399, -0.7049, -0.8017,  ..., -0.4049, -0.9271, -0.8684],
          [-0.8792, -0.6721, -0.7961,  ..., -0.3805, -0.9525, -0.8421]]]
]
)
```

# 训练

## batch

将train_data即**(2700,2,100,10)**划分为一个batch

```python
input = torch.stack(torch.stack([item[0] for item in data]).chunk(input_window,1)).squeeze()
target = torch.stack(torch.stack([item[1] for item in data]).chunk(input_window,1)).squeeze()
```



